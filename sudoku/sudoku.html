<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°ç‹¬æ¸¸æˆ - Sudoku</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .controls button, .controls select {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        .controls button:hover, .controls select:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .controls button:active {
            transform: translateY(0);
        }

        .info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }

        .info span {
            color: #667eea;
            font-weight: bold;
        }

        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 1px;
            background: #333;
            border: 3px solid #333;
            margin-bottom: 20px;
            aspect-ratio: 1;
        }

        .cell {
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
        }

        .cell:hover {
            background: #e3e3e3;
        }

        .cell.selected {
            background: #ffd700;
        }

        .cell.fixed {
            background: #f0f0f0;
            color: #000;
            cursor: default;
        }

        .cell.error {
            background: #ffcccc;
        }

        .cell.correct {
            background: #ccffcc;
        }

        /* 3x3å®«æ ¼è¾¹æ¡† */
        .cell:nth-child(3n) {
            border-right: 2px solid #333;
        }

        .cell:nth-child(9n) {
            border-right: none;
        }

        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid #333;
        }

        .numpad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .numpad button {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            background: #667eea;
            color: white;
            transition: all 0.2s;
        }

        .numpad button:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .numpad button.clear {
            background: #dc3545;
        }

        .numpad button.clear:hover {
            background: #c82333;
        }

        .message {
            text-align: center;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            display: block;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            .cell {
                font-size: 1.2em;
            }

            .numpad button {
                padding: 10px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æ•°ç‹¬æ¸¸æˆ</h1>

        <div class="controls">
            <select id="difficulty">
                <option value="easy">ç®€å•</option>
                <option value="medium" selected>ä¸­ç­‰</option>
                <option value="hard">å›°éš¾</option>
                <option value="expert">ä¸“å®¶</option>
            </select>
            <button onclick="newGame()">ğŸ†• æ–°æ¸¸æˆ</button>
            <button onclick="checkSolution()">âœ… æ£€æŸ¥ç­”æ¡ˆ</button>
            <button onclick="getHint()">ğŸ’¡ æç¤º</button>
            <button onclick="resetGame()">ğŸ”„ é‡ç½®</button>
        </div>

        <div class="info">
            <div>éš¾åº¦: <span id="currentDifficulty">ä¸­ç­‰</span></div>
            <div>æ—¶é—´: <span id="timer">00:00</span></div>
            <div>å‰©ä½™: <span id="remaining">0</span></div>
        </div>

        <div class="sudoku-grid" id="grid"></div>

        <div class="numpad">
            <button onclick="inputNumber(1)">1</button>
            <button onclick="inputNumber(2)">2</button>
            <button onclick="inputNumber(3)">3</button>
            <button onclick="inputNumber(4)">4</button>
            <button onclick="inputNumber(5)">5</button>
            <button onclick="inputNumber(6)">6</button>
            <button onclick="inputNumber(7)">7</button>
            <button onclick="inputNumber(8)">8</button>
            <button onclick="inputNumber(9)">9</button>
            <button onclick="inputNumber(0)" class="clear">æ¸…é™¤</button>
        </div>

        <div class="message" id="message"></div>
    </div>

    <script>
        let board = [];
        let solution = [];
        let initialBoard = [];
        let selectedCell = null;
        let timerInterval = null;
        let seconds = 0;
        let emptyCells = 0;

        // åˆå§‹åŒ–æ¸¸æˆ
        function init() {
            newGame();
        }

        // åˆ›å»ºç©ºæ•°ç‹¬æ¿
        function createEmptyBoard() {
            return Array(9).fill(null).map(() => Array(9).fill(0));
        }

        // æ£€æŸ¥æ•°å­—åœ¨ä½ç½®æ˜¯å¦æœ‰æ•ˆ
        function isValid(board, row, col, num) {
            // æ£€æŸ¥è¡Œ
            for (let x = 0; x < 9; x++) {
                if (board[row][x] === num) return false;
            }

            // æ£€æŸ¥åˆ—
            for (let x = 0; x < 9; x++) {
                if (board[x][col] === num) return false;
            }

            // æ£€æŸ¥3x3å®«æ ¼
            let startRow = Math.floor(row / 3) * 3;
            let startCol = Math.floor(col / 3) * 3;
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[startRow + i][startCol + j] === num) return false;
                }
            }

            return true;
        }

        // ä½¿ç”¨å›æº¯ç®—æ³•è§£æ•°ç‹¬
        function solveSudoku(board) {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (board[row][col] === 0) {
                        for (let num = 1; num <= 9; num++) {
                            if (isValid(board, row, col, num)) {
                                board[row][col] = num;
                                if (solveSudoku(board)) return true;
                                board[row][col] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        // ç”Ÿæˆæ–°çš„æ•°ç‹¬è°œé¢˜
        function generateSudoku() {
            // åˆ›å»ºç©ºæ¿
            let newBoard = createEmptyBoard();

            // éšæœºå¡«å……å¯¹è§’çº¿ä¸Šçš„ä¸‰ä¸ª3x3å®«æ ¼
            for (let box = 0; box < 9; box += 3) {
                let nums = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                shuffleArray(nums);
                let idx = 0;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        newBoard[box + i][box + j] = nums[idx++];
                    }
                }
            }

            // è§£å®Œæ•´æ•°ç‹¬ä»¥ç”Ÿæˆæœ‰æ•ˆè°œé¢˜
            solveSudoku(newBoard);

            // æ·±æ‹·è´è§£å†³æ–¹æ¡ˆ
            solution = newBoard.map(row => [...row]);

            // æ ¹æ®éš¾åº¦ç§»é™¤æ•°å­—
            let difficulty = document.getElementById('difficulty').value;
            let cellsToRemove;
            switch(difficulty) {
                case 'easy': cellsToRemove = 35; break;
                case 'medium': cellsToRemove = 45; break;
                case 'hard': cellsToRemove = 52; break;
                case 'expert': cellsToRemove = 58; break;
                default: cellsToRemove = 45;
            }

            let positions = [];
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    positions.push([i, j]);
                }
            }
            shuffleArray(positions);

            for (let i = 0; i < cellsToRemove; i++) {
                let [row, col] = positions[i];
                newBoard[row][col] = 0;
            }

            return newBoard;
        }

        // æ•°ç»„æ´—ç‰Œ
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // æ¸²æŸ“æ•°ç‹¬ç½‘æ ¼
        function renderGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            emptyCells = 0;
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;

                    if (board[i][j] !== 0) {
                        cell.textContent = board[i][j];
                        if (initialBoard[i][j] !== 0) {
                            cell.classList.add('fixed');
                        }
                    } else {
                        emptyCells++;
                    }

                    cell.addEventListener('click', () => selectCell(i, j));
                    grid.appendChild(cell);
                }
            }

            updateRemaining();
        }

        // é€‰æ‹©å•å…ƒæ ¼
        function selectCell(row, col) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.cell.selected').forEach(c => {
                c.classList.remove('selected');
            });

            // å¦‚æœæ˜¯å›ºå®šå•å…ƒæ ¼ï¼Œä¸é€‰æ‹©
            if (initialBoard[row][col] !== 0) return;

            // é€‰ä¸­æ–°å•å…ƒæ ¼
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('selected');
            selectedCell = { row, col };
        }

        // è¾“å…¥æ•°å­—
        function inputNumber(num) {
            if (!selectedCell) {
                showMessage('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå•å…ƒæ ¼', 'info');
                return;
            }

            const { row, col } = selectedCell;
            if (initialBoard[row][col] !== 0) {
                showMessage('ä¸èƒ½ä¿®æ”¹å›ºå®šæ•°å­—', 'error');
                return;
            }

            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);

            if (num === 0) {
                board[row][col] = 0;
                cell.textContent = '';
            } else {
                board[row][col] = num;
                cell.textContent = num;
            }

            updateRemaining();
            clearMessage();

            // æ£€æŸ¥æ˜¯å¦å®Œæˆ
            if (emptyCells === 1) {
                checkSolution();
            }
        }

        // æ›´æ–°å‰©ä½™ç©ºæ ¼
        function updateRemaining() {
            let count = 0;
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (board[i][j] === 0) count++;
                }
            }
            emptyCells = count;
            document.getElementById('remaining').textContent = count;
        }

        // æ£€æŸ¥è§£å†³æ–¹æ¡ˆ
        function checkSolution() {
            let isCorrect = true;
            let isComplete = true;
            let errors = [];

            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (board[i][j] === 0) {
                        isComplete = false;
                    } else if (board[i][j] !== solution[i][j]) {
                        isCorrect = false;
                        errors.push([i, j]);
                    }
                }
            }

            // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯/æ­£ç¡®æ ‡è®°
            document.querySelectorAll('.cell.error, .cell.correct').forEach(c => {
                c.classList.remove('error', 'correct');
            });

            if (!isCorrect) {
                errors.forEach(([row, col]) => {
                    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    cell.classList.add('error');
                });
                showMessage('æœ‰é”™è¯¯ï¼çº¢è‰²æ ‡è®°çš„æ•°å­—ä¸æ­£ç¡®', 'error');
            } else if (!isComplete) {
                showMessage('è¿˜æ²¡å®Œæˆï¼Œç»§ç»­åŠ æ²¹ï¼', 'info');
            } else {
                // æ ‡è®°æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆ
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        if (initialBoard[i][j] === 0) {
                            const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
                            cell.classList.add('correct');
                        }
                    }
                }
                stopTimer();
                showMessage('ğŸ‰ æ­å–œä½ æˆåŠŸå®Œæˆæ•°ç‹¬ï¼', 'success');
            }
        }

        // è·å–æç¤º
        function getHint() {
            if (!selectedCell) {
                showMessage('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå•å…ƒæ ¼', 'info');
                return;
            }

            const { row, col } = selectedCell;
            if (initialBoard[row][col] !== 0) {
                showMessage('è¿™æ˜¯å›ºå®šæ•°å­—', 'info');
                return;
            }

            if (board[row][col] === solution[row][col]) {
                showMessage('å·²ç»æ­£ç¡®äº†ï¼', 'info');
                return;
            }

            board[row][col] = solution[row][col];
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            cell.textContent = solution[row][col];
            cell.classList.add('correct');

            updateRemaining();
            clearMessage();

            if (emptyCells === 0) {
                stopTimer();
                showMessage('ğŸ‰ æ­å–œä½ æˆåŠŸå®Œæˆæ•°ç‹¬ï¼', 'success');
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            board = initialBoard.map(row => [...row]);
            renderGrid();
            clearMessage();
            startTimer();
        }

        // æ–°æ¸¸æˆ
        function newGame() {
            stopTimer();
            seconds = 0;
            updateTimer();

            board = generateSudoku();
            initialBoard = board.map(row => [...row]);
            selectedCell = null;

            const difficulty = document.getElementById('difficulty');
            const difficultyText = difficulty.options[difficulty.selectedIndex].text;
            document.getElementById('currentDifficulty').textContent = difficultyText;

            renderGrid();
            clearMessage();
            startTimer();
        }

        // è®¡æ—¶å™¨
        function startTimer() {
            stopTimer();
            timerInterval = setInterval(() => {
                seconds++;
                updateTimer();
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimer() {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('timer').textContent =
                `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(msg, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = msg;
            messageEl.className = `message ${type}`;
        }

        function clearMessage() {
            const messageEl = document.getElementById('message');
            messageEl.className = 'message';
            messageEl.textContent = '';
        }

        // é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '9') {
                inputNumber(parseInt(e.key));
            } else if (e.key === 'Backspace' || e.key === 'Delete' || e.key === '0') {
                inputNumber(0);
            }
        });

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
